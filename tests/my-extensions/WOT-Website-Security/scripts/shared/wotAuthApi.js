class _WotAuthApi{constructor(){this.root="https://auth.api.mywot.com"}getUser(e){const s=this.root+"/me",o={Authorization:"Bearer "+e,"Content-Type":"text/plain"};return new Promise((e,t)=>{WotNetwork.get(s,o).then(s=>{if(200===s.status){let o;try{o=JSON.parse(s.responseText)}catch(e){o={code:4006,message:"You've been logged out. Please login again"}}const t=o.score&&parseStatus(o.score);!o.roles[6]&&t&&(o.roles[6]=t),o.roles[7]?o.roles[6]=o.roles[7]:o.roles[8]?o.roles[6]=o.roles[8]:o.roles[9]?o.roles[6]=o.roles[9]:o.roles[10]&&(o.roles[6]=o.roles[10]),e(o)}else t({code:s.status,message:"Cannot get user info"})}).catch(e=>{})})}login(e,s){const o="object"==typeof e?e:{username:e,password:s},t=this.root+"/token?";return new Promise((e,s)=>{WotNetwork.postJson(t,o).then(o=>{const t=JSON.parse(o.responseText);if(200===o.status){const s=t.token;e(s)}else s({code:t.code,message:t.message})}).catch(e=>{})})}logout(e){return new Promise((s,o)=>{if(!e)return Promise.resolve();const t=this.root+"/logout",r={Authorization:"Bearer "+(e||"")};WotNetwork.postJson(t,{},r).then(t=>{200===t.status?s(e):o(t.status)}).catch(e=>{})})}register(e,s,o,t){const r="object"==typeof e?e:{name:e,mail:s,pass:o,Pass2:t},n=_.merge({},r,{Pass2:r.Pass2||r.pass}),a=this.root+"/signup?";return new Promise((e,s)=>{WotNetwork.postJson(a,n).then(o=>{const t=JSON.parse(o.responseText);if(200===o.status){400===t.status&&s({code:t.code,message:t.message});const o=t.token;e(o)}else s({code:t.code,message:t.message})}).catch(e=>{})})}forgot(e){const s="object"==typeof e?e:{username:e},o=this.root+"/forgot-pass?";return new Promise((e,t)=>{WotNetwork.postJson(o,_.merge({},s)).then(s=>{const o=JSON.parse(s.responseText);200===s.status?e(o):t({code:o.code,message:o.message})}).catch(e=>{})})}socialLoginUrl(e){return`${this.root}/${e}?source=extension`}}const WotAuthApi=new _WotAuthApi;