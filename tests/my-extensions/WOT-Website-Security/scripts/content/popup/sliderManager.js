class SliderManager{constructor(e){this.store=e,this.popupIframe=null,this.popupContainer=null,this.hideTimeOutRef=null,this.showTimeOutRef=null,this.isSliderOpen=!1,this.hightlightSection=""}init(){if("true"===document.body.getAttribute("wotDisconnected"))return webextApi.runtime.sendMessage({name:CONTENT_DISCONNECTED}),void 0;webextApi.runtime.onMessage.addListener((e,t,i)=>{const n=e.action,o=e.section;if(n===TOGGLE_WOT_SLIDER){if(i(TOGGLE_WOT_SLIDER),this.isSliderOpen)return this.hide();this.popupIframe=document.getElementById(WOT_POPUP_SLIDER_IFRAME),this.popupIframe&&o===this.hightlightSection||(this.popupIframe&&this.popupIframe.remove(),this.hightlightSection=o,this.initContainer(this.hightlightSection)),this.popupIframe&&!o||this.initContainer(o),this.show()}}),webextApi.runtime.connect().onDisconnect.addListener(()=>{this.hide(),document.body.setAttribute("wotDisconnected","true")})}initContainer(e){this.popupContainer=document.createElement("div"),this.popupContainer.id=WOT_POPUP_MAIN_CONTAINER,document.body.appendChild(this.popupContainer),this.popupOnboardingContainer=document.createElement("div"),this.popupOnboardingContainer.id=WOT_POPUP_ONBOARDING_CONTAINER,this.popupContainer.appendChild(this.popupOnboardingContainer),this.popupIframe=document.createElement("iframe"),this.popupIframe.id=WOT_POPUP_SLIDER_IFRAME,this.popupContainer.appendChild(this.popupIframe),this.popupIframe.style.width=SLIDER_WIDTH+"px",this.popupIframe.style.left=CLOSED_POSITION();const t=`${webextApi.runtime.getURL("/popupV2.html")}?wot_host=${window.location.hostname}`;this.popupIframe.src=e?`${t}&section=${e}`:t,document.body.addEventListener("click",this.autoHide.bind(this)),document.body.addEventListener("keyup",e=>{/^esc/i.test(e.key)&&this.hide()}),window.addEventListener("resize",this.autoPosition.bind(this)),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.handleLeaveCurrentTab()}),setTimeout(()=>{ReactDOM.render(React.createElement(ReactRedux.Provider,{store:this.store},React.createElement(PopupOnboardingHandler,null)),this.popupOnboardingContainer)},1e3)}handleLeaveCurrentTab(){this.isSliderOpen&&(this.isSliderOpen=!1,"safari"===browserName?this.hide():this.popupContainer.remove(),this.popupContainer=null),AddReviewHandler.closeAddReview()}show(){clearTimeout(this.hideTimeOutRef),this.showTimeOutRef=setTimeout(()=>{this.popupIframe.style.left=OPEN_POSITION(),this.isSliderOpen=!0,this.popupOnboardingContainer&&(this.popupOnboardingContainer.style.display="block")},100)}hide(){this.popupIframe&&(clearTimeout(this.showTimeOutRef),this.popupIframe.style.left=CLOSED_POSITION(),this.popupIframe.contentWindow.postMessage("wot-close-slider-event","*"),this.isSliderOpen=!1,this.popupOnboardingContainer&&(this.store.dispatch(turnOffPopupOnboarding()),this.popupOnboardingContainer.style.display="none"))}autoPosition(){this.isSliderOpen&&this.show()}autoHide(e){e&&this.popupIframe&&e.target.id!==ADD_REVIEW_CONTAINER_ID&&!e.target.closest("#"+WOT_POPUP_ONBOARDING_BUBBLE_ID)&&e.clientX<this.popupIframe.offsetLeft&&this.hide()}}